# Coyan: A Static Fault Tree Unreliability solver using Weighted Model Counting.

Coyan is a tool that internally translates a Fault Tree in GALILEO format to CNF formula, and if a WMC solver is provided,
runs the solver obtaining the Unreliability of the Fault Tree. It can also generate random static Fault Trees.

## Build

Create the binary `/target/release/coyan-cli` by running:

```bash
cargo build --release
```

## Usage

```bash
target/release/coyan-cli <COMMAND> [OPTIONS] 
```

Commands:

- `info`: Outputs information about the FT, like the amount of basic events, of gates and the number of clauses generated by the method.
  - `-i, --input`: Input fault tree in GALILEO format.
  - OPTIONS:
    - `-s, --simplify`: Simplify the FT by removing gates with only one child. [default: false]
    - `-m, --modularize`: Get the number of submodules of the FT. [default: false]
    - `-h, --help`: Print help

- `translate`: Translates the FT implicit formula to a CNF equisatisfiable formula. Outputs a DIMACS file with a wcnf.
  - `-i, --input`: Input fault tree in GALILEO format.
  - OPTIONS:
    - `-o, --output <OUTPUT>`: Output file, writes .cnf or .wcnf depending on the format.
    - `-t, --timebounds <TIMEBOUNDS> <TIMEBOUNDS> <TIMEBOUNDS>`: Time bounds for the exponential models. It creates a range of values according to the command arguments: `[start, end, step]`. Conflicts with `timepoint`.
    - `--timepoint <TIMEPOINT>`: Compute Unreliability of the FT a given time point [default: 1]. Conflicts with `timebounds`.
    - `EXTRA ARGUMENTS`
    - `-h, --help`: Print help

- `solve`: Executes a Solver to obtain the TEP of the FT at a given time point or time bounds.
  - `-i, --input`: Input fault tree in GALILEO format.
  - `-s, --solver-path <SOLVER_PATH>`: Solver path and arguments.
    - Supported Solvers: `GPMC`, `SharpSAT-TD`, `DMC` and `ADDMC`.
      - `SharpSAT-TD` and `DMC` solvers use the `.tmp` directory internally.
  - OPTIONS:
    - `-t, --timebounds <TIMEBOUNDS> <TIMEBOUNDS> <TIMEBOUNDS>`: Time bounds for the exponential models. It creates a range of values according to the command arguments: `[start, end, step]`. Conflicts with `timepoint`.
    - `--timepoint <TIMEPOINT>`: Compute Unreliability of the FT a given time point [default: 1]. Conflicts with `timebounds`.
    - `EXTRA ARGUMENTS`
    - `-h, --help`: Print help

- `importance`: Computes the Criticality Measure for all the BE. Each thread runs 1 FT at the time.
  - `-i, --input`: Input fault tree in GALILEO format.
  - `-s, --solver-path <SOLVER_PATH>`: Solver path and arguments.
    - Supported Solvers: `GPMC`, `SharpSAT-TD`, `DMC` and `ADDMC`.
      - `SharpSAT-TD` and `DMC` solvers use the `.tmp` directory internally.
  - OPTIONS:
    - `-t --timepoint`: Time point to compute the true TEP and the measures for each basic event [default: 1].
    - `EXTRA ARGUMENTS`
    - `-h, --help`: Print help

- `modularize`: Modularize the input FT into all his modules, compute the TEP of each module and replace the gate with a Basic Event, where the probability is the obtained TEP of the module. Finally, compute the TEP of the entire FT.
  - `-i, --input`: Input fault tree in GALILEO format.
  - `-s, --solver-path <SOLVER_PATH>`: Solver path and arguments.
    - Supported Solvers: `GPMC`, `SharpSAT-TD`, `DMC` and `ADDMC`.
      - `SharpSAT-TD` and `DMC` solvers use the `.tmp` directory internally.
  - OPTIONS:
    - `-t, --timepoint <TIMEPOINT>`: Compute Unreliability of the FT a given time point [default: 1].
    - `EXTRA ARGUMENTS`
    - `-h, --help`: Print help

- EXTRA ARGUMENTS:
  - `-n, --negate_or`: Negate top gate if is an OR, to favor UnitPropagation. Values are wrong if this is used together with the B+E preprocessor. [default: false].
  - `--timeout-s <TIMEOUT_S>`: Execution timeout for the WMC solver in seconds.
  - `--format <FORMAT>`: Output format for the CNF formula. The format gives the extension to the file. Support values `MC21` and `MCC` [default: `MC21`].
  - `--num-threads <NUM_THREADS>`: Number of threads to use.
  - `--verb`: Verbosity, if true prints more information. [default: false].
  - `--display`: Display progress bars, if possible. [default: false].
  - `--simplify`: Simplify the FT by removing one children gates. [default: true].
  - `--preprocess <PREPROCESS>`: If provided, postprocess the CNF formula by passing a CNF preprocessor. [default: None].

- `rft`
  - `-n, --n-nodes <N_NODES>`: Total number of nodes.
  - `-o, --output <OUTPUT>`: Output file, writes .dft files.
  - OPTIONS:
    - `--rate-be <RATE_BE:>`: Number in `(0,1]`. Rate of Basic Events from the total amount of Nodes. [default: 0.3]
    - `--rate-and <RATE_AND>`: Number in `(0,1]`. Rate of AND gates from the total amount of Nodes. [default: 0.3]
    - `--rate-or <RATE_OR>`: Number in `(0,1]`. Rate of OR gates from the total amount of Nodes. [default: 0.3]
    - `--rate-vot <RATE_OR>`: Number in `(0,1]`. Rate of VOT gates from the total amount of Nodes. [default: 0.3]
    - `--prob-multiplier <PROB_MULTIPLIER>`: Number in `(0,1]`, multiplies the random float number of the probability for Basic Events, so it can be a smaller number. [default: 0.0001]
    - `--perc-last <PERC_LAST>`: In which percentage of the last gates start to put the Basic Events if they were not used before. [default: 0.6]
    - `--max-n-children <MAX_N_CHILDREN>`: Specify the max number of children that a gate can have [default: 5]
    - `--timeout-s <TIMEOUT_S>`: Execution timeout for the WMC solver in seconds. [default: 300]
    - `--seed <SEED>`: In which percentage of the last gates start to put the Basic Events if they were not used before. [default: random]
    - `-h, --help`: Print help

## WMC solvers

For more details on Model Counting, we refer to the [Model Counting Competition](https://mccompetition.org/).
Currently, Coyan supports the WMC solvers:

- [GPMC](https://git.trs.css.i.nagoya-u.ac.jp/k-hasimt/GPMC)
- [ADDMC](https://github.com/vardigroup/ADDMC)
- [DMC](https://github.com/vardigroup/DPMC)
- [SharpSAT-TD](https://github.com/Laakeri/sharpsat-td)
